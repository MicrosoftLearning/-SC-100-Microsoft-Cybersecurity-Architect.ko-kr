# 글로벌 보안 액세스

모니터링 서버를 설정한 후에는 GSA(전역 보안 액세스)를 사용하여 파일 서버에 대한 보안 네트워킹을 설정해야 합니다. 특히 Tailwind Traders가 로컬 서버를 회사 IT 인프라로 가져오는 경우 이러한 파일 서버를 보안 클라우드 스토리지로 마이그레이션할 수 있을 때까지 이 머신에 대한 액세스가 보호되도록 해야 합니다. 직원이 서버에 액세스할 수 있도록 Tailwind Traders의 VPN 인프라를 재작업하지 않기로 결정했습니다. 

보안 네트워킹을 설정하려면 커넥터 생성 전에 Azure 앱 프록시를 만들고 클라이언트를 Entra ID에 등록합니다. 그런 다음 액세스 정책을 구성하고 GSA 클라이언트를 설치합니다. 마지막으로 GSA 연결을 테스트하여 모든 것이 제대로 작동하는지 확인합니다.

## 1부: 솔루션 설계(필수)

이 작업에서는 온-프레미스 환경에 대한 원격 액세스를 보호합니다.

### 디자인 접근 방법

초기 단계에서는 설명된 시나리오에 따라 요구 사항을 분석하고, 목표를 이해하고, 요구 사항을 정의합니다.

제공된 사용 사례에 따라 다음 요구 사항을 설명할 수 있습니다.

- 온-프레미스 서버에 안전한 원격 액세스 사용
- 기존 인프라와 
- Tailwind Traders의 사용되지 않는 인프라 

전역 보안 액세스는 Contoso Ltd.의 기존 클라우드 인프라와 통합되며 직원이 Tailwind Traders 로컬 인프라 내의 로컬 서버에 안전하게 원격으로 연결하도록 허용합니다. GSA를 검토하고 서비스 원격 액세스에 대한 다른 전략과의 차이점을 고려합니다.

### 제안된 솔루션

|요건|솔루션|작업 플랜:|
|----|----|----|
|온-프레미스 서버에 안전한 원격 액세스 사용| EntraID 전역 보안 액세스 | 전역 보안 액세스 사용  |
|기존 인프라와  | 애플리케이션 프록시 | Contoso의 Fileserver에 애플리케이션 프록시 배포 |

## 파트 2: 솔루션 구현(선택 사항)

### 작업 1: 전역 보안 액세스 활성화

첫 번째 단계는 테넌트에서 전역 보안 액세스를 활성화하는 것입니다.

1. 로컬 **관리자**로 **LON-SC1** VM(클라이언트 엔드포인트)에 로그인합니다. 랩 호스팅 공급자가 제공한 암호를 사용해야 합니다.
1. **Microsoft Edge**를 열고 주소 표시줄을 선택한 다음 **https://entra.microsoft.com**으로 이동하여 Entra 포털에 **MOD 관리자**(admin@WWLxZZZZZZ.onmicrosoft.com)로 로그인합니다(ZZZZZZ는 랩 호스팅 공급자가 제공한 고유 테넌트 ID).  암호는 랩 호스팅 공급자가 제공합니다.
1. **로그인 상태를 유지하시겠습니까?** 대화 상자에서 **이 메시지를 다시 표시 안 함** 체크박스를 선택하고 **아니요**를 선택합니다.
1. **암호 저장** 대화 상자에서 **지금 선택 안 함**을 선택합니다.
1. **Microsoft Edge에 로그인** 대화 상자가 나타나면 **아니요** 버튼을 선택합니다.
1. 화면 오른쪽 위에 **다단계 인증 관리**라는 정보 상자가 표시되면 **X**를 선택하여 닫습니다.
1. 왼쪽 탐색 창에서 **전역 보안 액세스**를 확장하고 **대시보드**를 선택합니다.
1. **테넌트에 전역 보안 액세스 활성화** 아래에서 **활성화**를 선택합니다.

전역 보안 액세스를 성공적으로 활성화했습니다.

### 작업 2: TLS 사용 설정 및 개인 네트워크 커넥터 설치

개인 네트워크 커넥터는 백 엔드 리소스 및 애플리케이션에 대한 액세스 권한이 있는 온-프레미스 환경의 Windows Server에 설치되며 전역 보안 액세스 서비스에 대한 연결을 용이하게 하는 데 사용되는 경량 에이전트입니다.  개인 네트워크 커넥터를 설치하기 전에 커넥터가 설치될 Windows 서버에 TLS 1.2를 사용하도록 설정해야 합니다.

1. 로컬 **관리자** 계정을 사용하여 서버 VM, **LON-SC2**에 로그인합니다. 암호는 랩 호스팅 공급자가 제공합니다.
1. VM에 로그인하면 서버 관리자 열립니다.  이 창을 최소화할 수 있습니다.
1. 개인 네트워크 커넥터를 설치하기 전에 TLS 1.2를 사용하도록 설정해야 합니다.  이 작업을 수행할 수 있는 여러 가지 방법이 있습니다. 이 연습에서는 명령을 복사하여 레지스트리 키를 파일로 설정한 다음 해당 파일을 실행합니다.

    1. **Microsoft Edge**를 엽니다.
    1. 브라우저 탭에서 URL **`https://learn.microsoft.com/en-us/entra/global-secure-access/how-to-configure-connectors`**(을)를 입력한 다음 키보드의 Enter 키를 눌러 제품 설명서를 엽니다.
    1. **TLS(전송 계층 보안) 요구 사항** 섹션으로 스크롤하고 **레지스트리 키 설정** 아래에 나열된 코드 상자에서 **복사**를 선택합니다.
    1. VM 내에서 메모장을 엽니다. 작업 표시줄의 검색 필드에 **`Notepad`**(을)를 입력한 다음 **메모장**을 선택하여 애플리케이션을 엽니다.
    1. **Ctrl+V**를 사용하여 메모장에 코드를 붙여넣습니다.  붙여넣은 코드에서 아무것도 변경하지 마세요. 코드의 첫 번째 줄이 필요합니다.
    1. 메모장에서 **파일**을 선택한 다음 **다른 이름으로 저장**을 선택합니다. 
    1. **파일 형식** 필드의 드롭다운에서 **모든 파일**을 선택하고 **파일 이름** 필드에 **`EnableTLS.reg`**(을)를 입력한 다음 **저장**을 선택합니다.  .reg 확장자를 사용하여 파일을 저장해야 합니다. 문서가 저장되는 위치를 기록한 다음 메모장을 닫습니다.
    1. 작업 표시줄에서 **파일 탐색기**를 열고 파일을 저장한 폴더로 이동합니다(이 PC > 문서).
    1. 파일 이름을 두 번 클릭하고 **Enable-TLS**를 실행합니다.  레지스트리 파일을 변경하고 있으므로 **계속하시겠습니까?** 가 표시됩니다.  **예**를 선택하고 **확인**을 선택합니다.  
    1. 레지스트리를 업데이트했기 때문에 서버를 다시 시작해야 합니다. 서버 VM의 작업 표시줄에서 **Windows 아이콘**을 선택하고, **전원**을 선택하고, **다시 시작**을 선택한 다음, **계속**을 선택합니다.
    1. 다시 시작한 후 로컬 **관리자** 권한으로 서버 VM에 다시 로그인합니다.
    1. 서버 관리자를 최소화하거나 닫습니다.
1. **Microsoft Edge**를 열고 주소 표시줄을 선택한 다음 **`https://entra.microsoft.com`** 으로 이동하여 Entra 포털에 **MOD 관리자**(admin@WWLxZZZZZZ.onmicrosoft.com)로 로그인합니다(ZZZZZZ는 랩 호스팅 공급자가 제공한 고유 테넌트 ID).  암호는 랩 호스팅 공급자가 제공합니다.
1. 이전 작업에서 수행한 것처럼 대화 상자를 해제합니다.
1. 왼쪽 탐색 패널에서 **전역 보안 액세스**를 확장하고, **연결**을 확장하고, **커넥터**를 선택합니다.
1. 개인 네트워크 커넥터 페이지의 위쪽에서 **커넥터 서비스 다운로드**를 선택합니다.
1. 정보를 검토한 다음, **약관 동의 및 다운로드**를 선택합니다.
1. 페이지의 오른쪽 위 모서리에 있는 다운로드 창에서 다운로드가 완료되면 **파일 열기**를 선택합니다.  파일 열기를 선택하기 전에 다운로드 창이 닫힌 경우 작업 표시줄에서 **파일 탐색기**를 선택하고 **다운로드** 폴더로 이동한 다음 **MicrosoftEntraPrivateNetworkConnectorInstaller** 파일을 실행합니다.
1. **사용 약관에 동의함** 옆의 확인란을 선택하고 **설치**를 선택합니다.
1. 설치 프로세스 중에 MOD 관리자의 사용자 이름 및 암호를 사용하여 로그인해야 합니다. 설치를 완료하는 데 몇 분 정도 걸립니다.
1. 설치가 완료되면 설치 창을 **닫고** 브라우저 페이지를 새로 고칩니다.  커넥터가 나열되고 활성 상태로 표시되어야 합니다.
1. Windows 검색 창의 작업 표시줄에 **`cmd`**(을)를 입력하고 **명령 프롬프트**를 선택합니다. 
1. 관리자: 명령 프롬프트 창에서 **`ipconfig`** 명령을 실행하고 서버의 개인 IP 주소를 적어 둔 다음 명령 프롬프트 창을 닫습니다.

온-프레미스 서버에 개인 네트워크 커넥터를 성공적으로 설치했습니다.

### 작업 3: 파일 서버에 폴더 만들기

이 작업에서는 GSA를 통해 액세스할 온-프레미스 파일 서버에 SMB 공유를 만듭니다.

1. LON-SC2에 계속 로그인한 상태여야 합니다.
1. 작업 표시줄에서 **파일 탐색기**를 열고 C: 드라이브로 이동하여 **공유**라는 폴더를 만듭니다.
1. 오른쪽 마우스 버튼을 사용하여 **공유** 폴더를 선택하고 **속성**을 선택합니다.
1. 공유 속성 창에서 **공유** 탭을 선택합니다.
1. **공유**를 선택합니다.
1. 드롭다운에서 **모두**를 선택하고 **추가**를 선택합니다.
1. **공유**를 선택합니다.
1. **아니요,개인 네트워크에 연결된 네트워크를 만듭니다**를 선택합니다.
1. **완료**를 선택한 다음 **닫기**를 선택합니다.
1. 파일 탐색기를 최소화하거나 닫습니다.

서버에 공유 폴더를 만들었습니다. GSA를 통해 액세스할 폴더와 해당 콘텐츠입니다.

### 작업 4: 빠른 실행 설정 및 사용자 할당

Private Access는 서비스를 통해 터널을 통과하려는 프라이빗 리소스를 구성하는 두 가지 방법을 제공합니다. 빠른 실행 또는 전역 보안 액세스 애플리케이션 이 연습에서는 빠른 실행을 사용합니다.

빠른 액세스는 보호하려는 FQDN 및 IP 주소의 기본 그룹입니다. 빠른 실행을 구성할 때 보안하려는 프라이빗 리소스의 컨테이너 역할을 하는 새 엔터프라이즈 애플리케이션을 만듭니다.

사용자가 GSA 클라이언트를 통해 파일 서버의 리소스에 액세스하려면 빠른 실행을 사용하고 테스트 사용자에게 할당해야 합니다.

1. 이 단계에서는 LON-SC2에 머물 수 있습니다.
1. 왼쪽 탐색 창에서 **전역 보안 액세스**를 확장하고 **애플리케이션**을 확장한 다음 **빠른 실행**을 선택합니다. 다음 정보를 입력합니다.
    - 이름: **`SMB to ContosoFS`**
    - 커넥터 그룹: **기본값**
1. **빠른 실행 애플리케이션 세그먼트 추가**를 선택하고 다음 정보를 입력합니다.
    - 대상 유형: **IP 주소**
    - IP 주소: 이전 단계에서 적어둔 서버의 개인 IP 주소, **`192.168.2.100`** 
    - 포트: **`445`**
1. **적용**을 선택합니다.
1. **저장**을 선택합니다. 애플리케이션 세그먼트의 상태 필드가 성공으로 표시되면 브라우저 페이지를 새로 고칩니다. 페이지를 새로 고치면 **빠른 실행 |  네트워크 액세스 속성** 페이지로 이동합니다.
1. 왼쪽에서 **사용자 및 그룹**을 선택합니다.
1. **사용자/그룹 추가**를 선택합니다.
1. **선택되지 않음**을 선택합니다.
1. 검색 필드에 **`MOD Administrator`**(을)를 입력한 다음, 검색 결과에서 이를 선택합니다.
1. 페이지 아래쪽에서 **선택**을 누르고 **할당**을 선택합니다.

테스트 사용자에 대한 빠른 실행을 사용하도록 설정했습니다.

### 작업 5: 디바이스 조인 Entra ID

전역 보안 액세스를 사용하려면 클라이언트 엔드포인트인 LON-SC1 VM을 Microsoft Entra ID에 조인해야 합니다. 그렇지 않으면 GSA 클라이언트가 작동하지 않습니다.

1. **LON-SC1** VM(클라이언트 엔드포인트 VM)으로 다시 전환합니다.
1. 오른쪽 마우스 버튼을 사용하여 작업 표시줄에서 Windows 아이콘을 선택하고 **설정**을 선택합니다.
1. 왼쪽 탐색 패널에서 **계정**을 선택합니다.
1. 계정 페이지에서 **회사 또는 학교 액세스**를 선택합니다.
1. 회사 또는 학교 계정을 추가하려면 **연결**을 선택합니다.
1. 창 아래쪽에서 **디바이스를 Microsoft Entra ID에 조인**을 선택합니다.
1. 랩 공급자가 제공한 **MOD Administrator** 관리자 자격 증명으로 로그인합니다.
1. **조직인지 확인** 창에서 정보를 검토한 다음 **조인**을 선택합니다.
1. **모든 설정 완료 **창에서 정보를 검토하고 **완료**를 선택합니다.
1. 디바이스가 MOD 관리자 계정과 조인된 Entra ID이므로 해당 계정을 사용하여 로그인해야 합니다.
    1. 작업 표시줄에서 **Windows** 아이콘을 선택하고 **관리자**를 선택한 다음 **사용자 전환**을 선택합니다.
    1. 창의 왼쪽 아래에서 **다른 사용자**를 선택한 다음 MOD 관리자 계정으로 로그인합니다.
    1. 계정을 설정하는 데 몇 분 정도 걸리며, 이후 **필요한 추가 정보** 창이 표시됩니다. 그러면 다단계 인증을 설정하는 프로세스가 시작됩니다.  MFA 설정 지침을 따릅니다.

엔드포인트가 Entra ID에 조인되면 전역 보안 액세스로 보호 중인 모든 리소스에 연결할 수 있는 GSA 클라이언트를 설정할 수 있습니다.

### 작업 6: 트래픽 전달 프로필 활성화 및 GSA 데스크톱 클라이언트 다운로드

온-프레미스 환경에서 프라이빗 리소스 또는 애플리케이션에 대한 액세스를 사용하려면 프라이빗 액세스에 대한 트래픽 전달 프로필을 사용하도록 설정하고 사용자를 할당해야 합니다.

또한 전역 보안 액세스 데스크톱 클라이언트를 다운로드하고 설치해야 합니다.  

전역 보안 액세스 데스크톱 클라이언트를 통해 연결하여 프라이빗 액세스 트래픽을 서비스로 전달할 수 있습니다.

1. MOD 관리자 계정으로 로그인한 **LON-SC1**에 계속 있어야 합니다.
1. **Microsoft Edge**를 엽니다. Microsoft Edge를 설정하라는 메시지가 표시됩니다.
1. Microsoft Edge를 열고 **`https://entra.microsoft.com`**(으)로 이동합니다.
1. 왼쪽 탐색 패널에서 **전역 보안 액세스**를 확장하고, **연결**을 확장하고, **트래픽 전달**을 선택합니다.  옵션을 보려면 **>>**(을)를 선택하여 왼쪽 탐색 패널을 확장해야 할 수 있습니다.
1. **프라이빗 액세스 프로필** 옆에 있는 슬라이더 단추를 선택한 다음 **확인**을 선택합니다.
1. 이제 프라이빗 액세스 프로필을 사용하도록 설정했으므로 사용자를 할당해야 합니다.
    1. 프라이빗 액세스 프로필 카드의 **사용자 및 그룹 할당**에서 **보기**를 선택합니다.
    1. **0명의 사용자, 0개의 그룹이 할당됨**이라 표시된 곳을 선택합니다.
    1. **사용자/그룹 추가**를 선택합니다.
    1. **선택되지 않음**을 선택합니다.
    1. 검색 창에 **`MOD Administrator`**(을)를 입력하고 **MOD 관리자**를 선택한 다음 **선택**을 누르고 **할당**을 선택합니다.
1. 왼쪽 탐색 창의 **연결**에서 **클라이언트 다운로드**를 선택합니다.
1. Windows 10/11에서 **클라이언트 다운로드**를 선택합니다.
1. 다운로드 창에서 **파일 열기**를 선택합니다. 파일 열기를 선택하기 전에 다운로드 창이 닫힌 경우 작업 표시줄에서 **파일 탐색기**를 선택하고 **다운로드** 폴더로 이동한 다음 **GlobalSecureAccessClient** 파일을 실행합니다.
1. **사용 약관에 동의함** 확인란을 선택하고 **설치**를 선택합니다. 팝업되는 사용자 계정 컨트롤 창에서 **예**를 선택합니다.
1. 설치가 성공적으로 완료되면 창을 **닫습니다**.
1. 작업 표시줄에서 위쪽 화살표를 선택하여 숨겨진 아이콘을 표시합니다.  여기에 전역 보안 액세스 클라이언트 아이콘이 표시됩니다. 녹색 확인 표시가 없는 경우 아이콘을 마우스 오른쪽 단추로 아이콘을 클릭하고 **사용**을 선택합니다. 녹색 확인 표시로 연결되었음을 표시하는 데 몇 분 정도 걸릴 수 있습니다.
1. 작업 표시줄에서 **파일 탐색기**를 선택하고 **이 PC**로 이동합니다. 줄임표(**...**)를 선택하고 **네트워크 드라이브 매핑**을 선택합니다.
1. 폴더 필드에서 `\\192.168.2.100\Share`(을)를 입력합니다. 앞에서 언급한 IP 주소를 사용하고 **다른 자격 증명을 사용하여 연결**을 선택합니다.
1. **마침**을 선택합니다.
1. 네트워크 드라이브를 매핑하려면 LON-SC2의 로컬 관리자 계정에 대한 자격 증명을 사용합니다.  
    1. 전자 메일 필드: **`Administrator`**(랩 호스터에 따라 달라질 수 있음).
    1. 암호 필드: **`Pa55w.rd`**(랩 호스터에 따라 달라질 수 있음).
    
    >[!NOTE] 로컬 관리자 계정을 사용하는 것은 일반적인 시나리오가 아님을 인식합니다. 이 연습에서는 간소화된 온-프레미스 환경을 사용하기 때문입니다. 좀 더 복잡한 온-프레미스 환경을 사용하는 보다 현실적인 시나리오에서는 사용자가 Entra ID 계정으로 프라이빗 리소스에 액세스하게 됩니다.

1. 다음 랩으로 이동하기 전에 최적의 화면 크기를 위해 사용자를 전환하는 것이 좋습니다.
    1. 작업 표시줄에서 **Windows** 아이콘을 선택하고 **MOD 관리자**를 선택한 다음 **사용자 전환**을 선택합니다.
    1. 창의 왼쪽 아래에서 **관리자**를 선택하고 로컬 관리자 계정으로 로그인합니다.

전역 보안 액세스를 사용하여 파일 서버에 성공적으로 연결했습니다.
