# 랩 1 - 연습 2 - 외부 공격 표면 관리

## 연습 개요

Contoso는 외부 공격 표면을 식별하고 관리하여 사이버 보안 태세를 향상시키고자 합니다. 이 표면에는 다른 클라우드 공급자에 호스트되는 자산이 포함됩니다. 이 목표를 달성하기 위해 Contoso는 공격 표면 데이터를 클라우드 네이티브 SIEM 솔루션인 Sentinel과 통합하려고 합니다. 이 통합으로 조직의 보안 모니터링 및 인시던트 대응 역량이 향상될 것입니다. 

## 1부: 솔루션 설계(필수)

이 작업에서는 외부 연결 자산과 해당 공격 표면의 개요를 확인하기 위한 개념을 디자인합니다.

### 디자인 접근 방법

초기 단계에서는 설명된 시나리오에 따라 요구 사항을 분석하고, 목표를 이해하고, 요구 사항을 정의합니다.

제공된 사용 사례에 따라 다음 요구 사항을 설명할 수 있습니다.

- Contoso의 외부 연결 자산 모니터링 및 보호
- contoso와 연결된 모든 자산 검색
- Contoso의 SIEM 솔루션에 데이터 통합
- 자산 관리 및 레이블 지정

두 번째 단계에서는 Contoso Ltd.의 기존 환경을 확인합니다. Microsoft Defender EASM(외부 공격 표면 관리)은 디지털 공격 표면을 지속적으로 검색하고 매핑하여 조직의 온라인 인프라를 외부에서 본 모습을 보여 줍니다. 노출된 리소스를 식별하고, 위험의 우선 순위를 지정하며, 취약성 및 노출 제어 기능을 방화벽 너머로 확장합니다.

### 제안된 솔루션

|요건|솔루션|작업 플랜:|
|----|----|----|
|Contoso의 외부 연결 자산 모니터링 및 보호| Defender EASM | Microsoft Defender EASM 리소스 만들기|
|Contoso와 연결된 모든 자산 검색 | Defender EASM |Contoso의 자산에 대한 검색 작업 만들기  |
|Contoso의 SIEM 솔루션에 데이터 통합 |Defender EASM, Log Analytics 작업 영역 | Log Analytics 작업 영역을 Defender EASM에 연결 |
|자산 관리 및 레이블 지정 | Defender EASM | 청구 가능 자산 및 태그 관리 |


## 파트 2: 솔루션 구현(선택 사항)

### 작업 1 - Defender EASM 설정

이 작업에서는 Defender EASM 작업 영역을 만듭니다.

1. 클라이언트 1 VM(LON-Sc1)에 **lon-sc1\admin** 계정으로 로그인합니다. 암호는 랩 호스팅 공급자가 제공합니다.
2. **Microsoft Edge**를 열고 주소 표시줄을 선택한 다음 **<https://portal.azure.com>** 으로 이동하여 Azure Portal에 <user1-ZZZZZZZ@LODSUATMCA.onmicrosoft.com> 사용자로 로그인합니다. 관리자의 암호는 랩 호스팅 공급자가 제공합니다.
3. 로그인 상태를 유지하시겠습니까? 대화 상자에서 이 메시지를 다시 표시 안 함 체크박스를 선택하고 아니요를 선택합니다.
4. 브라우저에 기본 전역 관리자 자격 증명을 저장하지 않으려면 **안 함**을 선택하여 하단에서 암호 저장 대화 상자를 닫습니다.
5. 상단 검색 창에 **Microsoft Defender EASM**을 검색합니다.
6. **만들기**를 선택합니다.
7. Microsoft Defender EASM 리소스 만들기에서 기존 리소스 그룹 **rg_eastus_soc**를 선택합니다.
8. 인스턴스 세부 정보에서 이름을 **EASM**으로 입력하고 지역에서 **미국 동부**를 선택합니다.
9. **검토 및 만들기**를 선택합니다.
10. **만들기**를 선택합니다.

Defender EASM 작업 영역을 성공적으로 만들었습니다.

### 작업 2 - 검색 만들기

이 작업에서는 Contoso Ltd.의 외부 연결 자산에 대한 검색을 만듭니다. 인스턴스를 만든 후에는 실제 데이터로 채워야 합니다. 그래서 이제 검색을 만들어 보겠습니다.

1. 아직 Azure Portal **<https://portal.azure.com>** 에 로그인한 상태여야 합니다.
2. 위쪽의 검색 창에 **Microsoft Defender EASM**을 검색하여 엽니다.
3. 지난 작업에서 만든 **EASM** 작업 영역을 선택합니다.
4. **조직 검색** 검색 필드에 **Contoso**를 검색합니다.
5. **Contoso Ltd.** 를 선택합니다.
6. **공격 표면 검색 시작**을 선택합니다.

Contoso의 외부 공격 표면 검색을 만들고 EASM 인스턴스에 실행 가능한 데이터를 채우는 데 성공했습니다.

### 작업 3 - 데이터 커넥터 및 Log Analytics 작업 영역 설정

이 작업에서는 Defender EASM에서 Sentinel에 사용할 Log Analytics 작업 영역으로의 데이터 연결을 구성합니다. Defender EASM 자산 또는 인사이트 정보는 Log Analytics에서 사용되어 다른 보안 데이터로 기존 워크플로를 보강할 수 있습니다.

1. 아직 Azure Portal **<https://portal.azure.com>** 에 로그인한 상태여야 합니다.
2. 위쪽 검색 창에 **Log Analytics 작업 영역**을 검색합니다.
3. 지난 연습에서 만든 **law-sentinel** 작업 영역을 선택합니다.
4. 왼쪽 탐색 창에서 **설정**을 펼치고 **에이전트**를 선택합니다.
5. 페이지를 그대로 둔 채 다른 탭을 열고 Azure Portal **<https://portal.azure.com>** 에 로그인합니다.
6.  위쪽의 검색 창에 **Microsoft Defender EASM**을 검색하여 엽니다.
7.  **EASM** 작업 영역을 선택합니다.
8.  왼쪽 탐색 창에서 **관리**를 확장하고 **데이터 연결**을 선택합니다.
9.  Log Analytics에서 **연결 추가**를 선택합니다.
10. 이름을 **law-sentinel**로 지정합니다.
11. 아직 열려 있어야 하는 Log Analytics 작업 영역에서 이전 탭으로 전환합니다.
12. **Log Analytics 에이전트 지침**을 펼칩니다.
13. Defender EASM - 데이터 연결 추가에서 **작업 영역 ID** 및 **기본 키**를 각 해당 필드에 복사합니다.
14. 콘텐츠에서 **모두**를 선택합니다.
15. 빈도에서 **일별**을 선택합니다.
16. **추가**를 선택합니다.

연결이 만들어지면 Log Analytics 작업 영역에 사용자 지정 로그 테이블이 만들어집니다. 그런 다음 Sentinel에서 이 데이터를 사용하여 보안 인시던트 만들기 또는 보강, 조사 플레이북 빌드, 기계 학습 알고리즘 학습 또는 수정 작업 트리거를 수행할 수 있습니다.

Defender EASM과 Log Analytics 작업 영역 간 연결을 성공적으로 설정했습니다.

### 작업 4 - 대시보드 검토 및 자산 레이블 지정

이 작업에서는 Defender EASM 보안 태세를 검토하고 발견한 내용에 대한 정보를 가져옵니다.

1. 아직 Azure Portal **<https://portal.azure.com>** 에 로그인한 상태여야 합니다.
2. 위쪽의 검색 창에 **Microsoft Defender EASM**을 검색하여 엽니다.
3. **EASM** 작업 영역을 선택합니다.
4. 왼쪽 탐색 창에서 **대시보드**를 펼치고 **공격 표면 요약**을 선택합니다.

공격 표면 요약 대시보드는 공격 표면의 영향을 받는 핵심 자산에 대한 주요 인사이트와 대략적인 개요를 제공합니다.

5. **공격 표면 요약** 대시보드를 검토합니다.
6. 왼쪽 탐색 창에서 **보안 태세**를 선택합니다.
7. 열려 있는 취약성에 대한 다양한 범주를 검토합니다.
8. **포트 열기** 카테고리에서 **웹 서버**를 선택합니다.
9.  찾은 IP 주소 **34.223.124.45**를 선택합니다.

추가 조사를 위해 자산에 레이블을 지정하기로 결정했습니다.

10. **자산 수정**을 선택합니다.
11. **새 레이블 만들기**를 선택합니다.
12. 이름을 **포트 열기**로 지정하고 **추가**를 선택합니다.
13. **레이블** 필드에 새로 만든 레이블을 할당합니다.
14. **업데이트**를 선택합니다.

보안 태세를 성공적으로 검토하고 추가 조사를 위해 자산에 레이블을 지정했습니다.

### 작업 5 - 자산 관리

이 작업에서는 검색된 자산을 관리하고 분류합니다.

1. 아직 Azure Portal **<https://portal.azure.com>** 에 로그인한 상태여야 합니다.
2. 위쪽의 검색 창에 **Microsoft Defender EASM**을 검색하여 엽니다.
3. **EASM** 작업 영역을 선택합니다.
4. 왼쪽 탐색 창에서 **일반**을 확장한 다음, **인벤토리**를 선택합니다.
5. 검색 아래의 드롭다운 메뉴에서 **레이블**을 선택합니다.
6. 아래 드롭다운 메뉴에서 최근 작업 4 **포트 열기**에서 만든 레이블을 선택합니다.
7. **검색**을 선택합니다.
8. 찾은 자산 **34.223.124.45**를 엽니다.
9. **웹 구성 요소** 열을 선택합니다.

이 자산이 Amazon에 호스트되고 일부 구성 요소에 열려 있는 CVE도 있지만 **최근** 및 **마지막 접속** 열에서 볼 수 있듯이 활성 상태가 아닙니다. 이는 이전 검색 실행에서 생성됩니다.
이 자산은 제3자에서 호스트하지만 여전히 공격 표면에 속하므로 조직에서의 역할에 따라 분류합니다.

10. **자산 수정**을 선택합니다.
11. **종속성**을 선택합니다.
12. **업데이트**를 선택합니다.

>[!NOTE]이 경우 종속성을 선택하는데 그 이유는 이 자산이 제3자가 소유하지만 소유 자산의 운영을 직접 지원하기 때문에 공격 표면에 포함된 인프라이기 때문입니다.

13. 오른쪽 위에서 **X**를 선택하여 인벤토리로 돌아가서 새 검색을 만듭니다.
14. 검색 쿼리를 **웹 구성 요소 이름 - 포함 - Amazon**으로 수정합니다.
15. **검색**을 선택합니다.
16. 모든 자산을 선택합니다.
17. **자산 수정**을 선택합니다.
18. 상태의 **종속성**을 선택하고 **업데이트**를 선택합니다.

상태가 **승인된 인벤토리**로 설정된 경우에만 자산이 대시보드 차트에 표시되고 매일 검사됩니다. 이러한 이유로 새로 검색된 자산을 검토하고 그에 따라 상태를 변경하는 것이 중요합니다.

이 연습의 일환으로 Defender EASM을 설정하고, Contoso의 외부 연결 환경 검색을 생성하고, 자산 및 해당 구성에 대한 심층적인 인사이트를 얻었으며, 대시보드에 Contoso가 직접 담당하는 데이터만 포함되도록 자산을 관리했습니다.
