# 랩 2 - 연습 1 - Entra ID 구성

Contoso Ltd.의 새로 승진한 IT 보안 전문가 Allan Deyoung은 최근 회사가 Tailwind Traders를 인수함에 따라 Entra ID 테넌트를 검토하고 새로운 보안 요구 사항을 결정했습니다. Allan이 할 일은 작업을 관리하고 인수로 인해 생긴 요구 사항을 충족하는 정책을 구현하는 것입니다. 

엔터프라이즈 애플리케이션을 검토한 결과 일부 사용자가 자신의 사서함 데이터에 액세스할 수 있는 권한을 타사 애플리케이션에 제공한 것으로 확인되었습니다. 이렇게 하면 이메일 서신으로 인해 데이터 손실이 발생할 잠재적 위험이 있습니다. 따라서 이 동작을 제한하지만 사용자가 Microsoft에서 확인한 웹 사이트에 로그인하고 로그인 ID를 공유하는 것은 허용하려고 합니다. 또한 사용자가 Entra ID의 ID를 사용하여 새 SaaS 제품에 대한 특정 액세스를 요청할 수 있도록 하려고 합니다. 

최근 파트너 조직이 SMS 가로채기를 통한 공격을 받은 적이 있어, NIST에 따른 인증 보증을 적용하려고 합니다. 이를 위해 SMS OTP를 비활성화하고 조직에서 AAL1 인증 방법의 사용을 제한하는 인증 강도 정책을 만들어 보겠습니다. 이 구성은 Entra ID 포털에서 만듭니다.

## 1부: 솔루션 설계(필수)

이 작업에서는 Contoso Ltd.가 직면한 위험을 해결하기 위한 개념을 설계합니다.

### 디자인 접근 방법

초기 단계에서는 설명된 문제에 따라 요구 사항을 분석하고, 목표를 이해하고, 요구 사항을 정의합니다.

제공된 사용 사례에 따라 다음 요구 사항을 설명할 수 있습니다.

- 타사 애플리케이션의 제어되지 않는 액세스 제한
- 사용자가 확인된 서비스에 로그인 ID를 공유할 수 있도록 허용
- 사용자가 SaaS 제품에 대한 액세스를 요청하도록 허용
- 인증 강도 향상

두 번째 단계에서는 Contoso Ltd.의 기존 환경을 검사합니다. Microsoft Entra ID는 Entra ID 정책을 사용하여 사용자 및 클라우드 애플리케이션의 액세스를 관리하고 제한하는 솔루션을 제공합니다. 어떤 컨트롤과 정책이 이미 존재하는지를 조사합니다. Entra ID 포털을 사용하여 현재 구성 및 정책을 검토하고 조정이 필요한지 또는 새 정책을 구현해야 하는지 확인합니다.

세 번째 단계는 솔루션의 개념을 만드는 것입니다. 조사 결과 현재 정책이 정의된 요구 사항을 충족하지 않음이 밝혀졌습니다. 따라서 반드시 Entra ID 구성을 조정해야 합니다. 

### 제안된 솔루션

|요건|솔루션|작업 플랜:|
|----|----|----|
|타사 애플리케이션의 제어되지 않는 액세스 차단|Entra ID 애플리케이션 정책|사용자 동의 범위를 확인된 게시자의 앱 또는 이 조직에서 등록한 앱의 "낮은 영향"으로 분류된 사용 권한으로 제한|
|사용자가 확인된 서비스에 로그인 ID를 공유할 수 있도록 허용|Entra ID 애플리케이션 정책|사용자 동의 범위를 확인된 게시자의 앱 또는 이 조직에서 등록한 앱의 "낮은 영향"으로 분류된 사용 권한으로 제한|
|사용자가 SaaS 제품에 대한 액세스를 요청하도록 허용|Entra ID 애플리케이션 정책|안전하게 사용할 수 있는 애플리케이션을 승인할 권한이 있는 사용자 정의|
|안전하지 않은 인증 방법의 사용 제한|Entra ID 인증 방법|SMS 및 음성 방법을 제외한 인증 강도 만들기|

## 파트 2: 솔루션 구현(선택 사항)

**참고:** 이 랩 단계는 M365 랩 프로필에서 실행해야 합니다.

### 작업 1 - 타사 앱 사용을 Microsoft에서 확인한 서비스로 제한

이 작업에서는 사용자가 애플리케이션에 부여할 수 있는 액세스의 수준을 제한합니다. 사용자가 직접 허용할 수 없는 액세스를 요청하는 기능도 추가합니다. 

1. 클라이언트 1 VM(LON-Sc1)에 **lon-sc1\admin** 계정으로 로그인합니다. 암호는 랩 호스팅 공급자가 제공합니다.
2. **Microsoft Edge**를 열고 주소 표시줄을 선택한 다음 **https://entra.microsoft.com**으로 이동하여 Entra ID 포털에 **MOD 관리자**(admin@WWLxZZZZZZ.onmicrosoft.com)로 로그인합니다(ZZZZZZ는 랩 호스팅 공급자가 제공한 고유 테넌트 ID). 관리자 암호는 랩 호스팅 공급자가 제공합니다.
3. **로그인 상태를 유지하시겠습니까?** 대화 상자에서 **이 메시지를 다시 표시 안 함** 체크박스를 선택하고 **아니요**를 선택합니다.
4. 다단계 인증을 설정하라는 메시지가 표시되고 지침을 따릅니다.
5. 브라우저에 기본 전역 관리자 자격 증명을 저장하지 않으려면 **안 함**을 선택하여 하단에서 암호 저장 대화 상자를 닫습니다.
6. 왼쪽 탐색 창에서 **ID** > **애플리케이션** > **엔터프라이즈 애플리케이션** > **보안** > **동의 및 권한**으로 이동합니다.
7. **사용 권한 분류**로 이동합니다.
8. Entra에서 **낮은 위험** 권한으로 많이 사용되는 권한을 제안합니다.
9. 모든 권한을 확인하고 **예, 선택한 권한을 추가합니다**를 선택하여 Entra ID 테넌트에서 **낮은 위험**으로 분류합니다.
10. **사용자 동의 설정**으로 이동합니다.
11. **애플리케이션에 대한 사용자 동의**에서 권장 옵션인 **선택한 권한에 대해 확인된 게시자의 앱에 대한 사용자 동의 허용**을 선택하여 8단계에서 확인된 게시자에 대해 정의한 **낮은 영향** 사용 권한에 사용자가 동의할 수 있도록 합니다.
12. **데이터에 액세스하는 앱에 대한 그룹 소유자 동의**에서 **그룹 소유자 동의 허용 안 함**을 선택합니다. 이로써 그룹 소유자 동의는 **낮은 위험**으로 정의된 권한 외의 권한에 동의할 수 있는 자격을 이미 가지고 있는 사용자로 제한됩니다.
13. **저장**을 선택합니다.
14. **관리자 동의 설정**으로 이동하고 **예**를 선택하여 관리자 동의 요청을 사용하도록 설정합니다.
15. **+ 사용자 추가**를 선택하여 **Lidia Holloway** 및 **MOD Administrator**를 관리자 동의 요청을 검토할 수 있는 사용자로 추가합니다.
16. **관리자 동의 설정** 창에서 **저장**을 선택합니다.

이제 모든 사용자가 애플리케이션에 부여할 수 있는 액세스를 제한하는 애플리케이션 동의 설정을 구성했습니다. 사용자는 여전히 애플리케이션에 대한 사용 권한 동의를 요청할 수 있으며 애플리케이션 관리 팀은 특정 애플리케이션의 필요성과 위험을 평가한 후 승인할 수 있습니다. 

### 작업 2 - 인증 강도 만들기

이 작업에서는 Entra ID 포털을 사용하여 조직 내에서 SMS OTP 사용을 제한하는 자체 인증 강도를 만듭니다. 

1. 계속 Entra ID 포털 **https://entra.microsoft.com**에 로그인된 상태이어야 합니다.
2. 왼쪽 탐색 창에서 **보호** > **인증 방법** > **인증 강도**로 이동합니다.
3. **+ 새 인증 강도**를 선택합니다.
4. **Hardened MFA**라는 이름을 입력합니다.
5. **피싱 방지 MFA**, **암호 없는 MFA**, **다단계 인증**을 선택합니다.
6. 다단계 인증에서 다음 항목의 선택을 해제합니다.
   - **임시 액세스 패스(다중 사용)**
   - **암호 + SMS**
   - **암호 + 음성**
   - **페더레이션된 단일 요소 + SMS**
   - **페더레이션된 단일 요소 + 음성**
7. **다음**을 선택합니다.
8. 위의 요소 중 인증 강도에 남아 있는 것이 없는지 검토하고 확인합니다.
9.  **만들기**를 실행합니다.

이제 SMS OTP를 인증 요소로 사용하는 것을 제한하는 인증 강도를 만들었습니다.
