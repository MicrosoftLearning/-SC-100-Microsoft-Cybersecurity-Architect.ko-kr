# 랩 4 - 연습 2 - 전역 보안 액세스

모니터링 서버를 설정한 후에는 GSA(전역 보안 액세스)를 사용하여 파일 서버에 대한 보안 네트워킹을 설정해야 합니다. 특히 Tailwind Traders가 로컬 서버를 회사 IT 인프라로 가져오는 경우 이러한 파일 서버를 보안 클라우드 스토리지로 마이그레이션할 수 있을 때까지 이 머신에 대한 액세스가 보호되도록 해야 합니다. 직원이 서버에 액세스할 수 있도록 Tailwind Traders의 VPN 인프라를 재작업하지 않기로 결정했습니다. 

보안 네트워킹을 설정하려면 커넥터 생성 전에 Azure 앱 프록시를 만들고 클라이언트를 Entra ID에 등록합니다. 그런 다음 액세스 정책을 구성하고 GSA 클라이언트를 설치합니다. 마지막으로 GSA 연결을 테스트하여 모든 것이 제대로 작동하는지 확인합니다.

## 1부: 솔루션 설계(필수)

이 작업에서는 온-프레미스 환경에 대한 원격 액세스를 보호합니다.

### 디자인 접근 방법

초기 단계에서는 설명된 시나리오에 따라 요구 사항을 분석하고, 목표를 이해하고, 요구 사항을 정의합니다.

제공된 사용 사례에 따라 다음 요구 사항을 설명할 수 있습니다.

- 온-프레미스 서버에 안전한 원격 액세스 사용
- 기존 인프라와 
- Tailwind Traders의 사용되지 않는 인프라 

전역 보안 액세스는 Contoso Ltd.의 기존 클라우드 인프라와 통합되며 직원이 Tailwind Traders 로컬 인프라 내의 로컬 서버에 안전하게 원격으로 연결하도록 허용합니다. GSA를 검토하고 서비스 원격 액세스에 대한 다른 전략과의 차이점을 고려합니다.

### 제안된 솔루션
<!--BITE AUSFÜLLEN-->
|요건|솔루션|작업 플랜:|
|----|----|----|
|온-프레미스 서버에 안전한 원격 액세스 사용| EntraID 전역 보안 액세스 | 전역 보안 액세스 사용  |
|기존 인프라와  | 애플리케이션 프록시 | Contoso의 Fileserver에 애플리케이션 프록시 배포 |

## 파트 2: 솔루션 구현(선택 사항)

## 작업 1: 전역 보안 액세스 활성화

첫 번째 단계는 테넌트에서 전역 보안 액세스를 활성화하는 것입니다. 이렇게 하면 Azure 앱 프록시를 사용하여 OnPremises 리소스에 대한 보안 액세스를 제공할 수 있습니다.

1. **lon-cl1\admin** 계정으로 **클라이언트 1 VM**(LON-CL1)에 로그인합니다. 암호는 랩 호스팅 공급자가 제공합니다.
2. **Microsoft Edge**를 열고 주소 표시줄을 선택한 다음 **https://entra.microsoft.com**으로 이동하여 Entra 포털에 **MOD 관리자**(admin@WWLxZZZZZZ.onmicrosoft.com)로 로그인합니다(ZZZZZZ는 랩 호스팅 공급자가 제공한 고유 테넌트 ID).  암호는 랩 호스팅 공급자가 제공합니다.
3. 다단계 인증을 설정하라는 메시지가 표시되면 지침을 따릅니다.
4. 로그인 상태를 유지하시겠습니까? 대화 상자에서 이 메시지를 다시 표시 안 함 체크박스를 선택하고 **아니요**를 선택합니다.
5. 브라우저에 기본 전역 관리자 자격 증명을 저장하지 않으려면 안 함을 선택하여 하단에서 암호 저장 대화 상자를 닫습니다.
6. 왼쪽 탐색 창에서 **전역 보안 액세스**를 확장하고 **대시보드**를 선택합니다.
7. **테넌트에 전역 보안 액세스 활성화** 아래에서 **활성화**를 선택합니다.

전역 보안 액세스를 성공적으로 활성화했습니다.

## 작업 2: 애플리케이션 프록시 배포

전역 보안 액세스는 로컬 리소스에 대한 보안 클라우드 엔드포인트를 만들 수 있는 애플리케이션 프록시 기반으로 합니다. 이 경우 이전에 설정한 테스트 서버가 프록시 인프라를 통해 통신하도록 허용합니다.

1. **서버 1 VM**(LON-SC2)에 **lon-sc1\admin** 계정으로 로그인합니다. 암호는 랩 호스팅 공급자가 제공합니다.
2. **Microsoft Edge**를 열고 주소 표시줄을 선택한 다음 **https://entra.microsoft.com**으로 이동하여 Entra 포털에 **MOD 관리자**(admin@WWLxZZZZZZ.onmicrosoft.com)로 로그인합니다(ZZZZZZ는 랩 호스팅 공급자가 제공한 고유 테넌트 ID).  암호는 랩 호스팅 공급자가 제공합니다.
3. 왼쪽 탐색 창의 **전역 보안 액세스**에서 **연결**을 확장하고 **커넥터**를 선택합니다.
4. **커넥터 서비스 다운로드**를 선택합니다.
5.  **사용 약관 동의 및 다운로드**를 선택합니다.
6.  **Microsoft Azure Active Directory 애플리케이션 프록시 커넥터**를 설치합니다.
7.  설치 프로세스 중에 랩에서 제공하는 사용자 이름 및 암호를 사용하여 로그인해야 합니다.
8.  **CMD**를 열고 **ipconfig** 명령을 실행한 다음 IP 주소를 적어둡니다.
9.  Entra 포털로 돌아가 커넥터 페이지를 새로 고칩니다.

온보딩된 VM 및 연결된 IP 주소가 표시됩니다. 이는 커넥터를 성공적으로 설정했다는 의미입니다.

## 작업 3: 파일 서버에서 공유 만들기

이 작업에서는 GSA를 통해 액세스할 온-프레미스 Fileserver에 SMB 공유를 만듭니다.

1. LON-SC2에 로그인한 상태여야 합니다.
2. **탐색기**를 열고 C: 드라이브로 이동하여 **공유**라는 폴더를 만듭니다.
3. 공유 폴더를 선택하고 **속성**을 엽니다.
4. **공유**를 선택합니다.
5. **공유**를 선택합니다.
6. 드롭다운에서 **모두**를 선택하고 **추가**를 선택합니다.
7. **공유**를 선택합니다.
8. **아니요,개인 네트워크에 연결된 네트워크를 만듭니다**를 선택합니다.

## 작업 4: 빠른 실행 설정 및 사용자 할당

사용자가 GSA 클라이언트를 통해 파일 서버에 액세스하려면 빠른 실행를 사용하도록 설정하고 테스트 사용자에게 할당해야 합니다. 이 구성이 없으면 테스트 사용자가 파일 서버에 연결할 수 없습니다.

1. 왼쪽 탐색 창에서 **애플리케이션**을 확장하고 **빠른 실행**을 선택합니다. 다음 정보를 입력합니다.
    - 이름: **SMB to ContosoFS**
    - 커넥터 그룹: **기본값**
1. **빠른 실행 애플리케이션 세그먼트 추가**를 선택하고 다음 정보를 입력합니다.
    - 대상 유형: IP 주소
    - IP 주소: "**YOUR VM IP**"
    - 포트: 445
1. **적용**을 선택합니다.
1. **저장**을 선택하고 빠른 실행 메뉴를 다시 로드합니다.
1. 왼쪽에서 **사용자 및 그룹**을 선택합니다.
1. **사용자/그룹 추가**를 선택합니다.
1. **선택되지 않음**을 선택합니다.
1. **MOD 관리자**를 선택합니다.
1. **선택** > **할당**을 클릭합니다.

테스트 사용자(이 경우 관리자 계정)에 대한 빠른 실행을 사용하도록 설정했습니다.

## 작업 5: 디바이스 조인 Entra ID

전역 보안 액세스를 사용하려면 클라이언트 엔드포인트를 Entra ID에 조인해야 합니다. 그렇지 않으면 GSA 클라이언트가 작동하지 않습니다.

1. LON-SC1에 연결한 다음 시작 메뉴를 열고 **설정**을 선택합니다.
2. **계정** > **회사 또는 학교 액세스**를 선택합니다.
3. 회사 또는 학교 계정을 추가하려면 **연결**을 선택합니다.
4. **Entra ID를 사용하여 디바이스 조인**을 클릭합니다.
5. 랩 공급자가 제공한 **MOD Administrator** 관리자 자격 증명으로 로그인합니다.

엔드포인트가 Entra ID에 조인되면 GSA 클라이언트를 사용하여 전역 보안 액세스로 보호 중인 모든 리소스에 연결할 수 있습니다.

## 작업 6: 프로필 활성화 및 연결 유효성 검사

전역 보안 액세스는 두 부분으로 나뉩니다. 작업 중인 부분은 프라이빗 액세스라고 하며 파일 서버 또는 OnPremises 애플리케이션과 같은 로컬 및 프라이빗 리소스를 보호합니다. 파일 서버에 대한 액세스를 사용하도록 설정하려면 사용자가 빠른 실행을 통해 할당된 리소스에 액세스할 수 있는 프라이빗 액세스 프로필을 사용하도록 설정해야 합니다.

1. Microsoft Entra 관리 센터의 왼쪽 탐색 창에 있는 전역 보안 액세스 메뉴에서 **연결**을 확장하고 **트래픽 전달**을 선택합니다.
2. **프라이빗 액세스 프로필**을 확인합니다.
3. **확인**을 선택합니다.
4. 왼쪽 탐색 창의 **연결**에서 **클라이언트 다운로드**를 선택합니다.
5. Windows 10/11에서 **클라이언트 다운로드**를 선택합니다.
6. **전역 보안 액세스 클라이언트**를 설치합니다.
7. 설치 프로세스 중에 MOD 관리자로 사인해야 합니다.
8. Windows에서 **탐색기**를 열고 **내 PC** 메뉴 모음으로 이동하여 줄임표(...)를 선택하고 **네트워크 드라이브 매핑**을 선택합니다.
9. 폴더: `\\IP-ADDRESS\Share` 이전에 적어 놓은 IP 주소를 사용합니다.
10. **마침**을 선택합니다.
11. 로컬 사용자 이름 및 암호를 입력하여 네트워크 드라이브를 매핑합니다.


전역 보안 액세스를 사용하여 파일 서버에 성공적으로 연결했습니다.
